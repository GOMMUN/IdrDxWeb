<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.idr.pdd.mapper.DashMapper">

	<select id="findAllW" parameterType="WorkContents"
		resultType="WorkContents">
		SELECT
		B.WORK_DATE,
		SUM(A.PROD_QTY) AS PROD_QTY,
		SUM(A.FIRSTTIME_FAIL_QTY) AS FIRSTTIME_FAIL_QTY,
		SUM(A.MANHOUR) AS
		MANHOUR,
		SUM(B.PLAN_QTY) AS PLAN_QTY
		FROM DSP_WORK_CONTENTS A
		JOIN
		DSP_WORKDAILY_REPORT B
		ON B.DATASEQ=A.WORKDAILY_SEQ
		AND
		B.ISUSABLE='Usable'
		AND A.ISUSABLE = 'Usable'
		AND B.WORK_DATE IN (
		CONVERT(DATE, GETDATE(), 112)
		,CONVERT(DATE, GETDATE()-1, 112)
		)
		GROUP BY
		B.WORK_DATE
	</select>

	<select id="findAllR" parameterType="RejectContents"
		resultType="RejectContents">
		SELECT
		A.REJECT_ITEMID,
		A.REJECT_TYPE,
		SUM(A.FIRSTTIME_REJECT_QTY) AS FIRSTTIME_REJECT_QTY
		FROM
		DSP_REJECT_CONTENTS A
		JOIN DSP_WORKDAILY_REPORT B
		ON
		B.DATASEQ=A.WORKDAILY_SEQ
		AND B.FACTORYID ='KEM'
		AND B.ISUSABLE
		='Usable'
		AND A.ISUSABLE = 'Usable'
		AND DATEPART(MONTH,B.WORK_DATE) =
		#{month}
		GROUP BY A.REJECT_ITEMID, REJECT_TYPE
		ORDER BY A.REJECT_ITEMID
		ASC
	</select>

	<select id="rank">
		SELECT R.LOCATIONID, SUM(R.PROD_QTY) AS
		PROD_QTY
		FROM(
		SELECT L.LOCATIONID, ISNULL(SUM(B.PROD_QTY),0) AS PROD_QTY
		FROM
		DSP_LOCATION L
		LEFT JOIN DSP_WORKDAILY_REPORT A ON L.LOCATIONID =
		A.LINEID
		AND A.WORK_DATE BETWEEN CONVERT(VARCHAR(8), DATEADD(DAY,-5,
		GETDATE()),
		112)
		AND CONVERT(VARCHAR(8), DATEADD(DAY, 0, GETDATE()),
		112)
		LEFT JOIN DSP_WORK_CONTENTS B ON A.DATASEQ = B.WORKDAILY_SEQ
		WHERE
		L.FACTORYID = 'KEM'
		GROUP BY L.LOCATIONID, B.PROD_QTY , A.WORK_DATE
		)R
		GROUP BY R.LOCATIONID
		ORDER BY PROD_QTY DESC, R.LOCATIONID ASC;
	</select>

	<select id="production" resultType="Map">
		SELECT SUM(PROD_QTY) AS
		PROD,SUM(MANHOUR) AS MANHOUR
		FROM
		DSP_WORK_CONTENTS A JOIN
		DSP_WORKDAILY_REPORT B
		ON B.DATASEQ
		=A.WORKDAILY_SEQ
		AND B.ISUSABLE
		='USABLE'
		AND A.ISUSABLE ='USABLE'
		AND
		B.FACTORYID ='KEM'
		AND B.WORK_DATE
		=CONVERT(CHAR(8), #{data} , 112)

	</select>

	<select id="chart1" resultType="FairProd" parameterType="String">
	SELECT A.dt,(SELECT LOCATIONNAME  FROM DSP_LOCATION WHERE LOCATIONID = ISNULL(B.LINEID,#{data}))AS LINEID
	,ISNULL(SUM(C.PROD_QTY),0)AS PROD_QTY
	FROM CheckDayOff A LEFT JOIN DSP_WORKDAILY_REPORT B ON B.WORK_DATE =A.dt
	AND B.LINEID =#{data}
	LEFT JOIN DSP_WORK_CONTENTS C ON B.DATASEQ =C.WORKDAILY_SEQ
	WHERE A.dt BETWEEN CONVERT(VARCHAR(8), DATEADD(DAY,-5,GETDATE()),112)
	AND CONVERT(VARCHAR(8), DATEADD(DAY, 0, GETDATE()),112)
	GROUP BY A.dt,B.LINEID
	ORDER BY A.dt
	</select>




</mapper>